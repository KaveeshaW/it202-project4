<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>project4</title>
  <link href="https://unpkg.com/material-components-web@v4.0.0/dist/material-components-web.min.css" rel="stylesheet">
  <script src="https://unpkg.com/material-components-web@v4.0.0/dist/material-components-web.min.js"></script>
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

  <style>
    :root {
      --mdc-theme-primary: navy;
    }

    body {margin: 0;}
    main {margin-left: 8px;}
    
    .view {
      display: none;
    }
  </style>

  </head>
  <body>  
    
    <aside class="mdc-drawer mdc-drawer--modal">
    <div class="mdc-drawer__content">
      <nav class="mdc-list">
        <a class="mdc-list-item mdc-list-item--activated" href="#home" aria-current="page">
          <i class="material-icons mdc-list-item__graphic" aria-hidden="true">home</i>
          <span class="mdc-list-item__text">Home</span>
        </a>
        <a class="mdc-list-item" href="#search" aria-current="page">
          <i class="material-icons mdc-list-item__graphic" aria-hidden="true">search</i>
          <span class="mdc-list-item__text">Search</span>
        </a>
        <a class="mdc-list-item" href="#table">
          <i class="material-icons mdc-list-item__graphic" aria-hidden="true">table_chart</i>
          <span class="mdc-list-item__text">Table</span>
        </a>
        <a class="mdc-list-item" href="#chart">
          <i class="material-icons mdc-list-item__graphic" aria-hidden="true">show_chart</i>
          <span class="mdc-list-item__text">Chart</span>
        </a>
      </nav>
    </div>
  </aside>

  <div class="mdc-drawer-scrim"></div>

<header class="mdc-top-app-bar">
  <div class="mdc-top-app-bar__row">
    <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
      <button class="material-icons mdc-top-app-bar__navigation-icon mdc-icon-button">menu</button>
      <span class="mdc-top-app-bar__title">CoronaVirus Data</span>
    </section>
    <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end" role="toolbar">
      <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="Download">file_download</button>
      <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="Print this page">print</button>
      <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="Bookmark this page">bookmark</button>
    </section>
  </div>
</header>

  <main class="mdc-top-app-bar--fixed-adjust">

<!--     <button class="mdc-button foo-button mdc-button--raised">
    <div class="mdc-button__ripple"></div>
    <span class="mdc-button__label">Button</span>
    </button> -->
    <div class="view" id="home">Home
      <p>Data is from https://pomber.github.io/covid19/timeseries.json</p></div>
    <div class="view" id="search">Search
      
    <input list="countryList" name="country" id="theCountryList">
      <datalist id="countryList">
      </datalist>
    <button type="submit" id="submitCountry">Add Country</button>
    <button id="plotThings">Plot</button>
    <p id="listOfCountries"></p>
      
    </div>
    <div class="view" id="table">Confirmed Cases
    <div id="table_div"></div></div>
    <div class="view" id="chart">Chart
    <div id="curve_chart" style="width: 900px; height: 500px"></div></div>
    
    
    
  </main>
    
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      //load google charts package
      google.charts.load('current', {'packages':['corechart', 'table']});
      let totalRecovered = 0;
      let countryNames = [];
      let specificData = {};
      let userPlotted = false;
      getData = () => {
        //fetch data
        fetch("https://pomber.github.io/covid19/timeseries.json")
      .then(response => response.json())
      .then(data => {
        specificData = data;
        let dataArray = [["date", "US"]];
        let dataList = document.querySelector("#countryList"); 
        for(const country in data) {
           //gets the names of the country
           countryNames.push(country);
          
          //for the option menu showing all of the different countries
           let option = document.createElement("option");
           option.textContent = country;
           option.value = country;
           dataList.appendChild(option);
        }
        //loop US data, insert into 2d array
        data["US"].forEach(({ date, confirmed, recovered, deaths }) =>
          dataArray.push([date, confirmed])
        );
        drawChart(dataArray);
        drawTable(dataArray);
      });
      }
      
      //adds the country to a list that will be used to display later
      let whichCountry = document.querySelector("#theCountryList");
      let userSelection = [];
      document.querySelector("#submitCountry")
        .addEventListener("click", (event) =>
        {
        if(userPlotted) {
          userSelection = [];
        }
        userSelection.push(whichCountry.value);
         let paragraph = document.querySelector("#listOfCountries");
        if(userPlotted) {
          paragraph.textContent = "";
          userPlotted = false;
        }
         paragraph.textContent += whichCountry.value +" ";
        whichCountry.value = "";
        console.log(userSelection);
        });
      
      let totalDataPoints = 0;
      let count = 0;
      let dataArray = [["date", "confirmed", "country"]];
      document.querySelector("#plotThings")
        .addEventListener("click", (event) =>                        
        {
          userPlotted = true;
          for(const country of userSelection) {
            specificData[country].forEach(({ date, confirmed, recovered, deaths }) => {
              totalDataPoints++; 
              dataArray.push([date, confirmed, country]);
            });
          }
        let paragraph = document.querySelector("#listOfCountries");
        paragraph.textContent += "I do not know how to structure the data to pass it into the chart, thus nothing will change. It does populate an array with the countries choosen, and you can see that when you look at the console after plotting. There is a table and a line graph on the other screens, but it is not correct. Not sure why the line graph looks like that. Clearing the data almost works when you try different countries and plot again (look at console for that)";
        console.log("this is what would be plotted: " + dataArray);
//         //         let dataPoints = [[], []];
//         let whichRow = 0;
//         let whichColumn = 0;
//         while(count < totalDataPoints) {
//           for(const country in userSelection) {
//             dataPoints[whichRow][whichColumn]
//           }
//         }
      });
      
      //creates the line chart
      drawChart = (dataArray, userSelection) => {
        
        //convert into a google charts table
//         let data = google.visualization.DataTable();
        let data = google.visualization.arrayToDataTable(dataArray);
//         for(const country of userSelection) {
//           data.addColumn('number', country);
//         }
        let options = {
          title: 'COVID-19 Confirmed Cases US',
          curveType: 'function',
          legend: { position: 'bottom' }
        };

        let chart = new google.visualization.LineChart(document.querySelector('#curve_chart'));
        chart.draw(data, options);
      }
      
      //creates the table 
      drawTable = (dataArray) => {
        let data = new google.visualization.arrayToDataTable(dataArray);
        var table = new google.visualization.Table(document.getElementById('table_div'));
        table.draw(data, {width: '50%', height: '100%'});
      }
      //drawChart(dataArray);
         
    google.charts.setOnLoadCallback(getData);
    //google.charts.setOnLoadCallback(drawChart);
    
    //mdc.ripple.MDCRipple.attachTo(document.querySelector('.foo-button'));
    mdc.topAppBar.MDCTopAppBar.attachTo(document.querySelector('header.mdc-top-app-bar'));

    const drawer = mdc.drawer.MDCDrawer.attachTo(document.querySelector('.mdc-drawer'));
//     document.querySelector("div#curve_chart").style.display = "none";
    
    const hideViews = () => {
      document.querySelectorAll("div.view").forEach(item => {
        item.style.display = "none";
      })  
    };
    
    document.querySelector(".mdc-top-app-bar__navigation-icon")
      .addEventListener("click", 
          (e) => {drawer.open = true;}
      );
      
    document.querySelectorAll("aside.mdc-drawer a.mdc-list-item").forEach(item => {
      item.addEventListener('click', event => {
        hideViews();
        //could also use event.toElement.id if the specific tag has an id
        //target is an id selector with the hash symbol
        let target = item.getAttribute("href");
        document.querySelector(target).style.display = "block";
        drawer.open = false;
      })
    })
    </script>
    
  </body>
</html>